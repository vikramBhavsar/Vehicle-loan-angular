--=========== CREATE TABLE COMMANDS
CREATE DATABASE VEHICLE_LOAN;
use VEHICLE_LOAN;


CREATE TABLE ADMIN_TBL(
	aid INT IDENTITY PRIMARY KEY,
	ANAME VARCHAR(20),
	EMAIL_ID VARCHAR(100),
	APASSWORD VARCHAR(100)
);

CREATE TABLE USER_TBL(
	UID INT IDENTITY PRIMARY KEY,
	EMAIL_ID VARCHAR(100),
	APASSWORD VARCHAR(100)
);


CREATE TABLE USER_INFO_TBL(
	UIID INT IDENTITY PRIMARY KEY,
	UID INT FOREIGN KEY REFERENCES USER_TBL(UID),
	FIRST_NAME VARCHAR(30),
  MIDDLE_NAME VARCHAR(30),
	LAST_NAME VARCHAR(30),
	AGE INT,
	GENDER CHAR(1),
	MOBILE_NO VARCHAR(15),
	UADDRESS VARCHAR(100),
	USTATE VARCHAR(100),
	UCITY VARCHAR(100),
	PIN_CODE VARCHAR(20),
	ACCOUNT_NO VARCHAR(30) NOT NULL
);

CREATE TABLE TOE_TBL
(
	TOEID INT IDENTITY PRIMARY KEY,
	EMPLOYMENT_TYPE VARCHAR(20)
);


CREATE TABLE EMPLOYMENT_DETAILS_TBL
(
	EDID INT IDENTITY PRIMARY KEY,
	UID INT FOREIGN KEY REFERENCES USER_TBL(UID),
	TOEID INT FOREIGN KEY REFERENCES TOE_TBL(TOEID),
	YEARLY_INCOME MONEY,
	EXISTING_EMI_MONTHLY MONEY DEFAULT 0
);

CREATE TABLE CAR_MAKE_TBL
(
	CAR_MAKE_ID INT IDENTITY PRIMARY KEY,
	CAR_MAKE VARCHAR(30)
);

CREATE TABLE VEHICLE_DETAILS_TBL(
	V_ID INT IDENTITY PRIMARY KEY,
	CAR_MAKE_ID INT FOREIGN KEY REFERENCES CAR_MAKE_TBL(CAR_MAKE_ID),
  EX_SHOWROOM_PRICE MONEY,
  CAR_MODEL VARCHAR(30)
);

CREATE TABLE USER_IDENTITY_DOCS_TBL(
	UIDID INT IDENTITY PRIMARY KEY,
	UID INT FOREIGN KEY REFERENCES USER_TBL(UID),
	ADHAAR_CARD VARCHAR(1000),
	PAN_CARD VARCHAR(1000),
	PHOTO VARCHAR(1000),
	SALARY_SLIP VARCHAR(1000)
);

CREATE TABLE STATUS_TBL(
	STATUS_ID INT IDENTITY PRIMARY KEY,
	STATUS_VAL VARCHAR(30)
);

CREATE TABLE LOAN_APPLICATION_TBL(
	LAPPID INT IDENTITY PRIMARY KEY,
	UID INT FOREIGN KEY REFERENCES USER_TBL(UID),
	VID INT FOREIGN KEY REFERENCES VEHICLE_DETAILS_TBL(V_ID),
	LOAN_AMMOUNT MONEY,
	LOAN_TENURE INT,
	RATE_OF_INTEREST DECIMAL(3,2),
	IS_USED CHAR(1),
	AGEOLD int,
	STATUS_ID INT FOREIGN KEY REFERENCES STATUS_TBL(STATUS_ID)
);

CREATE TABLE LOAN_DETAILS_TBL(
	LDTID INT IDENTITY PRIMARY KEY,
	LAPPID INT FOREIGN KEY REFERENCES LOAN_APPLICATION_TBL(LAPPID),
	UID INT FOREIGN KEY REFERENCES USER_TBL(UID),
	APPROVED_ON DATE
);


CREATE TABLE BANK_PAYMENTS_TBL(
	BPID INT IDENTITY PRIMARY KEY,
	UID INT FOREIGN KEY REFERENCES USER_TBL(UID),
	LDTID INT FOREIGN KEY REFERENCES LOAN_DETAILS_TBL(LDTID),
	MONTHLY_DATE DATE,
	PRINCIPAL_AMMOUNT DECIMAL(10,2),
	INTEREST DECIMAL(10,2),
	STATUS INT DEFAULT 0
);


--============== DUMMY DATA INSERTION



INSERT INTO USER_TBL VALUES ('vikrambhavsar@lntinfotech.com','pass123');
INSERT INTO BANK_ACC_TBL VALUES ('V-SKY4587');
INSERT INTO USER_INFO_TBL VALUES (1,'Vikram','Bhavsar',22,'m','9865745815','Thane Circle','Maharashtra','Thane','411578',1);
INSERT INTO CAR_MAKE_TBL VALUES('Hundai');
INSERT INTO VEHICLE_DETAILS_TBL VALUES (1,3500000,'Tuscon');
INSERT INTO VEHICLE_DETAILS_TBL VALUES (1,2400000,'Elantra');

--================ CREATING VIEWS FOR COMPLEX DATA.

CREATE VIEW VIEW_USER_DASHBOARD_VIEW
AS 
SELECT U.FIRST_NAME,U.LAST_NAME,U.AGE,U.GENDER,U.MOBILE_NO ,UO.EMAIL_ID,
C.CAR_MAKE,V.CAR_MODEL,V.EX_SHOWROOM_PRICE,
L.LOAN_AMMOUNT, L.LOAN_TENURE, L.RATE_OF_INTEREST,UO.UID,V.V_ID,L.LAPPID
FROM LOAN_APPLICATION_TBL L
INNER JOIN USER_INFO_TBL U ON U.UID = L.UID
INNER JOIN USER_TBL UO ON UO.UID = L.UID
INNER JOIN VEHICLE_DETAILS_TBL V ON V.V_ID = L.VID
INNER JOIN CAR_MAKE_TBL C ON C.CAR_MAKE_ID = V.CAR_MAKE_ID;

SELECT * FROM VIEW_USER_DASHBOARD_VIEW;
